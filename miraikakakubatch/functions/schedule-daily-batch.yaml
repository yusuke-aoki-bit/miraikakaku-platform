apiVersion: v1
kind: ConfigMap
metadata:
  name: batch-job-schedule
  namespace: default
data:
  schedule.sh: |
    #!/bin/bash
    set -e
    
    echo "ğŸš€ æ¯æ—¥17:00 å®šæœŸãƒãƒƒãƒå®Ÿè¡Œé–‹å§‹: $(date)"
    
    # Google Cloud Batch Jobå®Ÿè¡Œ
    gcloud batch jobs submit training-data-batch-$(date +%Y%m%d-%H%M) \
      --config=gcloud-batch-job.yaml \
      --location=us-central1
    
    echo "âœ… ãƒãƒƒãƒã‚¸ãƒ§ãƒ–æŠ•å…¥å®Œäº†: $(date)"
    
    # å®Ÿè¡ŒçŠ¶æ³ç›£è¦–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    echo "ğŸ“Š ãƒãƒƒãƒã‚¸ãƒ§ãƒ–çŠ¶æ³ç¢ºèª..."
    gcloud batch jobs list --location=us-central1 --limit=5
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: daily-training-data-batch
  namespace: default
spec:
  schedule: "0 17 * * *"  # æ¯æ—¥17:00 (UTC)
  timeZone: "Asia/Tokyo"   # æ—¥æœ¬æ™‚é–“
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: batch-runner
          containers:
          - name: batch-scheduler
            image: gcr.io/google.com/cloudsdktool/google-cloud-cli:latest
            command: ["/bin/bash"]
            args: ["/scripts/schedule.sh"]
            volumeMounts:
            - name: schedule-script
              mountPath: /scripts
            env:
            - name: CLOUDSDK_CORE_PROJECT
              value: "effective-shore-r41fc"
            - name: CLOUDSDK_COMPUTE_REGION  
              value: "us-central1"
          volumes:
          - name: schedule-script
            configMap:
              name: batch-job-schedule
              defaultMode: 0755
          restartPolicy: OnFailure
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3