# ğŸ” Cloud SQLçµ±åˆå¾Œ æ®‹ä»¶èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“… èª¿æŸ»æ—¥: 2025å¹´8æœˆ22æ—¥

## ğŸ¯ **å®Ÿè£…å®Œäº†æ¸ˆã¿é …ç›®**

### âœ… 1. **Data Feed Service v3.0 å®Œæˆ**
- ãƒ¡ãƒ¢ãƒªå†…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‰Šé™¤
- Cloud SQLã‹ã‚‰éŠ˜æŸ„ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾— (12,107éŠ˜æŸ„)
- Yahoo Financeå°‚ç”¨ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¾¡æ ¼ãƒ»äºˆæ¸¬
- ãƒ•ã‚¡ã‚¤ãƒ«: `miraikakakudatafeed/universal_stock_api_v2.py`

### âœ… 2. **API/Batchã‚µãƒ¼ãƒ“ã‚¹ä¿®æ­£**
- SQLiteãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œå…¨å‰Šé™¤
- Cloud SQLå°‚ç”¨æ¥ç¶šã‚¯ãƒ©ã‚¹ä½œæˆ
- ãƒ•ã‚¡ã‚¤ãƒ«: `cloud_sql_only.py` (API/Batch)

### âœ… 3. **SQLiteãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤**
- `miraikakakuapi/functions/miraikakaku.db` å‰Šé™¤æ¸ˆã¿
- ä»–ã®SQLiteãƒ•ã‚¡ã‚¤ãƒ«ãªã—ç¢ºèªæ¸ˆã¿

### âœ… 4. **Docker/ç’°å¢ƒè¨­å®šæ›´æ–°**
- MySQLæ¥ç¶šãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¿½åŠ 
- ç’°å¢ƒå¤‰æ•°çµ±ä¸€ (`.env.cloud_sql`)

## âš ï¸ **ç™ºè¦‹ã•ã‚ŒãŸæ®‹ä»¶ãƒ»å•é¡Œ**

### ğŸ”´ 1. **é‡å¤§ï¼šCloud SQLæ¥ç¶šã‚¨ãƒ©ãƒ¼**
```
âŒ (1045, "Access denied for user 'root'@'119.231.51.27'")
åŸå› : IPã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼å•é¡Œ
çŠ¶æ³: 34.30.87.157 â†’ 34.58.103.36 (IPæ›´æ–°æ¸ˆã¿)
```

### ğŸ”´ 2. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¸æ•´åˆ**
```
å•é¡Œ: 
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ â†’ localhost:8000 (Data Feed Service)
- constants.ts â†’ https://miraikakaku-api-enhanced-*** (æœ¬ç•ªAPI)
- äºŒé‡ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçŠ¶æ…‹
```

### ğŸ”´ 3. **æœªä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**
- `main.py`: `init_database` â†’ `init_database_async` ä¿®æ­£æ¸ˆã¿
- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: SQLiteä½¿ç”¨ï¼ˆå•é¡Œãªã—ï¼‰

## ğŸ“Š **ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£çŠ¶æ³**

| ã‚µãƒ¼ãƒ“ã‚¹ | æ¥ç¶šå…ˆ | çŠ¶æ…‹ | ãƒ‡ãƒ¼ã‚¿ |
|---------|-------|------|--------|
| **Frontend** | localhost:8000 | âŒ æ··ä¹± | Data Feed Service |
| **API (Cloud Run)** | Cloud SQL | âŒ æ¥ç¶šå¤±æ•— | 12,107éŠ˜æŸ„ |
| **Data Feed (Local)** | Cloud SQL | âŒ æ¥ç¶šå¤±æ•— | Yahoo Finance |
| **Batch (Cloud Run)** | Cloud SQL | âŒ æ¥ç¶šå¤±æ•— | å‡¦ç†åœæ­¢ |

## ğŸ”§ **ç·Šæ€¥ä¿®æ­£ãŒå¿…è¦ãªé …ç›®**

### 1. **Cloud SQLæ¥ç¶šä¿®å¾© (æœ€å„ªå…ˆ)**
```bash
# IPè¨±å¯è¨­å®šç¢ºèª
gcloud sql instances describe miraikakaku | grep authorizedNetworks

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š
gcloud sql users set-password root --host=% --instance=miraikakaku --password=Yuuku717
```

### 2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¥ç¶šå…ˆçµ±ä¸€**
é¸æŠè‚¢A: Data Feed ServiceçµŒç”±ï¼ˆæ¨å¥¨ï¼‰
```typescript
// ã™ã¹ã¦localhost:8000ã«çµ±ä¸€
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
```

é¸æŠè‚¢B: æœ¬ç•ªAPIç›´æ¥æ¥ç¶š
```typescript
// æœ¬ç•ªCloud Run APIç›´æ¥æ¥ç¶š
NEXT_PUBLIC_API_BASE_URL=https://miraikakaku-api-enhanced-***
```

### 3. **ç’°å¢ƒå¤‰æ•°çµ±ä¸€**
```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹å…±é€šç’°å¢ƒå¤‰æ•°
CLOUD_SQL_HOST=34.58.103.36
CLOUD_SQL_PASSWORD=Yuuku717
CLOUD_SQL_CONNECTION_NAME=gen-ai-study-411309:us-central1:miraikakaku
```

## ğŸ“‹ **æ¨å¥¨å®Ÿè£…ãƒ—ãƒ©ãƒ³**

### Phase 1: ç·Šæ€¥ä¿®å¾© (ä»Šã™ã)
1. Cloud SQLèªè¨¼å•é¡Œè§£æ±º
2. IPè¨±å¯è¨­å®šç¢ºèª
3. æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### Phase 2: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£çµ±ä¸€ (1æ™‚é–“ä»¥å†…)
1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¥ç¶šå…ˆã‚’æ±ºå®š
2. ç’°å¢ƒå¤‰æ•°çµ±ä¸€
3. ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•

### Phase 3: æ¤œè¨¼ (30åˆ†)
1. å…¨ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ
2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèª
3. æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

## ğŸ¯ **æœŸå¾…ã•ã‚Œã‚‹æœ€çµ‚çŠ¶æ…‹**

```
Frontend â†’ Data Feed Service (Yahoo Financeå°‚ç”¨)
                â†“
            Cloud SQL (12,107éŠ˜æŸ„ãƒã‚¹ã‚¿ãƒ¼)
                â†‘
API/Batch Services (ç›´æ¥æ¥ç¶š)
```

## ğŸ“Š **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼çµ±ä¸€è¨ˆç”»**

| ãƒ‡ãƒ¼ã‚¿ç¨®é¡ | ã‚½ãƒ¼ã‚¹ | çµŒç”± | æœ€çµ‚ä¿å­˜å…ˆ |
|-----------|--------|------|-----------|
| **Master Data** | Cloud SQL | Direct | Frontend |
| **Price Data** | Yahoo Finance | Data Feed | Frontend |
| **Predictions** | AIè¨ˆç®— | Data Feed | Frontend |
| **Historical** | Cloud SQL | API Service | Frontend |

## ğŸš¨ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

1. **å³åº§å®Ÿè¡Œ**: Cloud SQLæ¥ç¶šä¿®å¾©
2. **è¨­è¨ˆæ±ºå®š**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¥ç¶šå…ˆçµ±ä¸€æ–¹é‡
3. **å®Ÿè£…**: ä¿®æ­£ã¨ãƒ†ã‚¹ãƒˆ
4. **æ¤œè¨¼**: å…¨ä½“å‹•ä½œç¢ºèª

---

## ğŸ“ˆ **æˆæœã¾ã¨ã‚**

âœ… **é”æˆæ¸ˆã¿**:
- SQLiteå®Œå…¨å»ƒæ­¢
- Cloud SQLçµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹ç¯‰
- 12,107éŠ˜æŸ„ãƒ‡ãƒ¼ã‚¿çµ±åˆ
- Yahoo Financeå°‚ç”¨APIæ§‹ç¯‰

âŒ **æ®‹èª²é¡Œ**:
- Cloud SQLæ¥ç¶šèªè¨¼å•é¡Œ
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¥ç¶šå…ˆä¸æ•´åˆ
- ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚¨ãƒ©ãƒ¼

**é€²æ—ç‡: 80% å®Œäº†**

---

*Generated by Integration Analysis Tool*  
*2025-08-22 09:30:00*